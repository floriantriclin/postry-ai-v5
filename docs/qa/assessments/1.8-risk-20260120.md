# Risk Profile: Story 1.8 - Full Quiz Integration

Date: 2026-01-20
Reviewer: Quinn (Test Architect)

## Executive Summary

- **Total Risks Identified**: 5
- **Critical Risks**: 0
- **High Risks**: 1
- **Risk Score**: 81/100

The integration of the quiz engine is the most complex frontend task in Epic 1. The main risks revolve around state management and the orchestration of multiple concurrent or background API calls.

## High Risks Requiring Attention

### 1. TECH-001: Race Conditions in State Machine

**Score: 6 (High)**
**Probability**: Medium (2) - The story introduces prefetching and "fire & forget" background calls.
**Impact**: High (3) - Inconsistent state can block the quiz, lead to missing questions, or display incorrect data.
**Mitigation**:
- Use a robust state machine pattern (Reducer) with explicit loading states per phase.
- Implement "In-Flight" checks to ignore redundant or outdated API responses.
- **Testing Focus**: Unit tests for the reducer covering overlapping actions and out-of-order responses.

## Risk Distribution

### By Category
- **Technical**: 2 risks (1 high)
- **Performance**: 1 risk (medium)
- **Data**: 1 risk (low)
- **Business**: 1 risk (medium)
- **Operational**: 0 risks

### By Component
- **Frontend (QuizEngine)**: 4 risks
- **API Client**: 1 risk

## Detailed Risk Register

| Risk ID | Title | Probability | Impact | Score | Priority | Mitigation Strategy |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **TECH-001** | Race Conditions in State Machine | Medium (2) | High (3) | 6 | High | Explicit reducer states + In-flight guards. |
| **PERF-001** | API Latency during "Early Trigger" | Medium (2) | Medium (2) | 4 | Medium | Ensure loader UI is engaging; optimize prefetch triggers. |
| **BUS-001** | UX Friction in "Tech & Brut" Loaders | Medium (2) | Medium (2) | 4 | Medium | User testing/review of the animation speed and clarity. |
| **DATA-001** | Sync failure between Refine and Profile | Low (1) | High (3) | 3 | Low | Ensure /profile can handle partial vector updates or has its own retry logic. |
| **TECH-002** | Inconsistent Fallback mid-flow | Low (1) | Medium (2) | 2 | Low | Unified "Error" state that switches the entire engine to local mock mode. |

## Risk-Based Testing Strategy

### Priority 1: Critical & High Risk Tests (TECH-001)
- **Reducer Logic Tests**: 100% coverage of state transitions.
- **E2E Race Condition Simulation**: Use Playwright to simulate slow API responses during transitions.

### Priority 2: Performance & UX (PERF-001, BUS-001)
- **Lighthouse/Performance Audit**: Verify that API calls don't block the main thread.
- **Visual Regression**: Ensure "Snap" transitions don't cause layout shifts.

### Priority 3: Fallback & Edge Cases (TECH-002, DATA-001)
- **Network Interruption Test**: Simulate 500/Timeout errors at each step (Phase 1, Archetype, Phase 2, Refine, Profile).

## Risk Acceptance Criteria

### Must Fix Before Production
- All state machine transitions validated via unit tests.
- Graceful degradation to `mock-quiz.json` for all 4 main endpoints.

### Can Deploy with Mitigation
- Minor latency in Phase 2 prefetch (as long as it doesn't block UI).
- Console logging of "silent" failures for `/refine`.

## Monitoring Requirements
- Track `api_fallback_triggered` event in analytics.
- Monitor response times for `/generate` and `/archetype` specifically.
