# Test Design: Story 1.8 - Full Quiz Integration

Date: 2026-01-20
Designer: Quinn (Test Architect)

## Test Strategy Overview

Following the **MVP "Lean"** strategy defined in `docs/architecture/testing-standards.md`, we focus on critical logic and the end-to-end flow.

- **Total test scenarios**: 9
- **Unit tests**: 4 (44%) - Focus on Reducer logic
- **Integration tests**: 3 (33%) - Focus on API orchestration triggers
- **E2E tests**: 2 (22%) - Focus on happy path and fallback
- **Priority distribution**: P0: 5, P1: 3, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: Orchestration du Flux de Données

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.8-UNIT-001 | Unit | P0 | Reducer updates Phase 1 questions on success | Validates core data state transition. |
| 1.8-UNIT-002 | Unit | P1 | Reducer handles Phase 2 prefetch arrival | Ensures background data doesn't disrupt foreground state. |
| 1.8-INT-001 | Integration | P0 | QuizEngine calls `/generate?phase=1` on mount | Verifies early trigger mechanism. |
| 1.8-INT-002 | Integration | P1 | QuizEngine triggers `/generate?phase=2` during archetype reveal | Verifies background prefetching timing. |

### AC2: Gestion de l'Expérience Utilisateur (UX)

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.8-E2E-001 | E2E | P0 | Complete 11-question flow to final reveal | Validates the "Happy Path" value delivery. |
| 1.8-UNIT-003 | Unit | P2 | Transition "Snap" triggers immediate state change | Verifies "Zero Friction" logic in reducer. |

### AC3: Robustesse et Fallback

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.8-UNIT-004 | Unit | P0 | Reducer switches to `useMock: true` on any API error | Ensures graceful degradation logic is sound. |
| 1.8-E2E-002 | E2E | P0 | API failure at Archetype step triggers seamless mock fallback | Critical reliability test. |

### AC4: Qualité du Code

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 1.8-INT-003 | Integration | P1 | API Client correctly serializes payloads for `/refine` | Ensures data integrity between FE and BE. |

## Risk Coverage (Ref: 1.8-risk-20260120.md)

| Risk ID | Mitigation Test(s) |
| :--- | :--- |
| **TECH-001** (Race Conditions) | 1.8-UNIT-002, 1.8-INT-002 |
| **PERF-001** (Latency) | 1.8-INT-001 (Early Trigger verification) |
| **DATA-001** (Sync failure) | 1.8-INT-003 |
| **TECH-002** (Inconsistent Fallback) | 1.8-UNIT-004, 1.8-E2E-002 |

## Recommended Execution Order

1. **P0 Unit Tests** (`1.8-UNIT-001`, `1.8-UNIT-004`): Validate the state machine foundations.
2. **P0 Integration Tests** (`1.8-INT-001`): Ensure the app actually starts the flow.
3. **P0 E2E Tests** (`1.8-E2E-001`, `1.8-E2E-002`): Confirm the end-to-end value and fallback.
4. **P1/P2 Tests**: Refine and edge cases.
