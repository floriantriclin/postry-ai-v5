# Plan de Test : Story 2.5 - Vue "Post Révélé"

**Date:** 2026-01-24
**Auteur:** Gemini Test Architect
**Documents de Référence:**
- [User Story: 2.5 - Post View](<docs/stories/story-2-5-post-view.md>)
- [Profil de Risque: 2.5](<docs/qa/assessments/2.5-risk-profile.md>)
- [Standards de Test](<docs/architecture/testing-standards.md>)

## 1. Objectifs et Périmètre des Tests

### 1.1. Objectifs

Ce plan de test vise à valider l'ensemble des fonctionnalités décrites dans la Story 2.5. Les objectifs principaux sont de s'assurer que :
1.  Un utilisateur authentifié peut voir son post le plus récent.
2.  L'expérience utilisateur de "révélation" du post est fluide et impactante.
3.  La page est sécurisée, fonctionnelle et visuellement conforme au design attendu.
4.  Les actions utilisateur (copier, déconnexion) sont opérationnelles.

### 1.2. Hors Périmètre

-   Tests de performance de la base de données Supabase.
-   Tests de la génération du contenu du post (couvert par d'autres stories).
-   Tests exhaustifs sur tous les navigateurs et appareils existants (limité aux cibles définies).

## 2. Stratégie de Test

Conformément aux standards du projet, nous adopterons une approche multi-niveaux, en mettant l'accent sur les tests E2E pour cette story très orientée UI/UX.

| Niveau de Test | Outil | Focus | Rationale |
| :--- | :--- | :--- | :--- |
| **Tests Unitaires (TU)** | Vitest, RTL | Hook `useCopyToClipboard` | Isoler et valider la logique de copie et de gestion d'état, qui est réutilisable et critique pour l'action rapide. |
| **Tests d'Intégration (TI)** | Vitest, RTL | `PostRevealView` | Valider le composant en isolation, en lui passant des `props` simulées (post, loading, empty) pour vérifier l'affichage conditionnel. |
| **Tests End-to-End (E2E)** | Playwright | Parcours utilisateur complet | Simuler la navigation, l'authentification (via mock de session), l'animation et les interactions pour valider le flux réel. |
| **Tests Manuels** | Chrome DevTools, Appareil Mobile | Qualité visuelle & Responsive | Valider la fluidité de l'animation et l'intégrité du design sur différentes tailles d'écran, ce qui est difficile à automatiser. |


## 3. Scénarios de Test Détaillés

### 3.1. Tests Unitaires (Vitest)

| ID Test | Description | Étapes (Arrange, Act, Assert) | Attendu |
| :--- | :--- | :--- | :--- |
| **TU-2.5-01** | **Hook `useCopyToClipboard`** - Le hook doit copier le texte et gérer l'état `isCopied`. | 1. **Arrange**: Rendre un composant de test qui utilise le hook. Mock de `navigator.clipboard.writeText`.<br>2. **Act**: Simuler un clic sur le bouton qui déclenche la copie.<br>3. **Assert**: Vérifier que `writeText` a été appelé. Vérifier que l'état `isCopied` passe à `true`, puis redevient `false` après le timeout. | La fonction de copie est appelée et l'état de feedback est correctement mis à jour. |

### 3.2. Tests d'Intégration (React Testing Library)

| ID Test | Description | Étapes | Attendu |
| :--- | :--- | :--- | :--- |
| **TI-2.5-01** | **Composant `PostRevealView`** - Affichage du post en état de succès. | 1. Rendre le composant en lui passant un objet `post` mocké.<br>2. Vérifier la présence du thème, de l'archétype et du contenu du post. | Le composant affiche toutes les métadonnées et le corps du post. |
| **TI-2.5-02** | **Composant `PostRevealView`** - Affichage en état de chargement. | 1. Rendre le composant en simulant un état de chargement (ex: `post={null}`, `isLoading={true}`).<br>2. Chercher la présence du `LoaderMachine`. | Le loader est visible et le contenu du post est masqué. |
| **TI-2.5-03** | **Composant `PostRevealView`** - Affichage en état vide. | 1. Rendre le composant avec `post={null}` et `isLoading={false}`.<br>2. Chercher le message "Aucun post généré" et le bouton de retour. | Le message d'état vide et le bouton sont visibles. |


### 3.3. Tests End-to-End (Playwright)

| ID Test | Description | Étapes | Attendu | Risque Couvert |
| :--- | :--- | :--- | :--- | :--- |
| **E2E-2.5-01** | **Accès non authentifié** | 1. Naviguer vers `/dashboard` sans être authentifié.<br>2. Vérifier l'URL actuelle. | L'utilisateur est redirigé vers la page d'accueil (`/`). | **R-2.5-01** |
| **E2E-2.5-02** | **Happy Path - Révélation du post** | 1. Authentifier l'utilisateur (via un setup de test qui injecte une session valide).<br>2. Naviguer vers `/dashboard`.<br>3. Attendre que le post soit visible et vérifier qu'il a la classe `blur-sm`.<br>4. Attendre 1.5s.<br>5. Vérifier que le post n'a plus la classe `blur-sm` (ou a `blur-0`).<br>6. Vérifier que le contenu du post est lisible. | Le post s'affiche d'abord flouté, puis devient net. Le contenu est correct. | **R-2.5-02**, **R-2.5-03** |
| **E2E-2.5-03** | **Interaction - Copier & Déconnexion** | 1. Suivre les étapes de E2E-2.5-02.<br>2. Cliquer sur le bouton `[ COPIER LE TEXTE ]`.<br>3. Vérifier que le texte du bouton devient "COPIÉ !".<br>4. Attendre 3s, vérifier que le texte redevient l'original.<br>5. Cliquer sur le bouton de déconnexion.<br>6. Vérifier la redirection vers la page d'accueil. | Les actions de copie et de déconnexion fonctionnent et fournissent le feedback attendu. | **R-2.5-05**, **R-2.5-08** |
| **E2E-2.5-04** | **Snapshot Visuel** | 1. Suivre les étapes de E2E-2.5-02.<br>2. Prendre un snapshot de la carte du post (`.post-card`).<br>3. Comparer avec l'image de référence. | Aucune régression visuelle n'est détectée sur le design de la carte. | **R-2.5-04** |

### 3.4. Tests Manuels

| ID Test | Description | Étapes | Attendu |
| :--- | :--- | :--- | :--- |
| **MAN-2.5-01**| **Validation Responsive** | 1. Ouvrir la page `/dashboard` sur Chrome.<br>2. Utiliser les DevTools pour simuler différentes tailles d'écran (iPhone 12, iPad Mini).<br>3. Vérifier qu'il n'y a pas de débordement de contenu, que les boutons sont cliquables et que le texte est lisible. | Le design reste cohérent et fonctionnel sur mobile. | **R-2.5-07** |
| **MAN-2.5-02**| **Fluidité de l'animation** | 1. Effectuer le parcours E2E-2.5-02 sur Chrome et Firefox.<br>2. Observer attentivement l'animation de "défloutage". | L'animation est fluide, sans clignotement ou sauts inattendus. | **R-2.5-03** |

## 4. Matrice de Traçabilité

| Critère d'Acceptation (Story 2.5) | ID(s) de Test Correspondant(s) |
| :--- | :--- |
| 1. Route Protégée | `E2E-2.5-01`, `E2E-2.5-08` |
| 2. Animation de Révélation | `E2E-2.5-02`, `MAN-2.5-02` |
| 3. Design "Tech & Brut" | `E2E-2.5-04`, `MAN-2.5-01` |
| 4. Affichage du Contenu | `TI-2.5-01`, `E2E-2.5-02` |
| 5. Actions Rapides (Copier) | `TU-2.5-01`, `E2E-2.5-03` |
| 6. Shell Applicatif (Déconnexion) | `E2E-2.5-03` |
| 7. Gestion des États (Loading, Empty) | `TI-2.5-02`, `TI-2.5-03` |
