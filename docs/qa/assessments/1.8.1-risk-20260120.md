# Risk Profile: Story 1.8.1

Date: 2026-01-20
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 1
- High Risks: 2
- Risk Score: 65/100

## Critical Risks Requiring Immediate Attention

### 1. TECH-001: API Orchestration Failure causing Blank Screen

**Score: 9 (Critical)**
**Probability**: High - Async states in `QuizEngine` are complex; failure to handle 'loading' or 'error' correctly at the entry point will block the user.
**Impact**: High - Complete blocker for the quiz funnel.
**Mitigation**:
- Implementation of a strict `error` state in the reducer.
- Mandatory fallback to `mock-quiz.json` on any network failure or status >= 400.
**Testing Focus**: 
- Mocking network failures (500, timeout) and verifying automatic fallback to mock data.
- Testing 'loading' state visibility to ensure user feedback.

## Risk Distribution

### By Category

- Technical (TECH): 3 risks (1 critical)
- Operational (OPS): 1 risk (1 high)
- Data (DATA): 1 risk (1 high)

### By Component

- Frontend (QuizEngine): 3 risks
- Integration (API Client): 2 risks

## Detailed Risk Register

| Risk ID | Description | Probability | Impact | Score | Priority |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TECH-001 | Orchestration failure (blank screen) | High (3) | High (3) | 9 | Critical |
| DATA-001 | Type mismatch between API and Client | Medium (2) | High (3) | 6 | High |
| OPS-001 | Fallback to mock-quiz fails if mock is stale | Medium (2) | High (3) | 6 | High |
| TECH-002 | Race conditions on Early Trigger | Low (1) | Medium (2) | 2 | Low |
| TECH-003 | Reducer state desynchronization | Low (1) | Medium (2) | 2 | Low |

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests
- **Failover Logic**: Simulate API 500/404/Timeout. Verify `QuizEngine` switches to `mock-quiz.json` without user interruption beyond a slight delay.
- **State Transition**: Verify `idle -> loading -> success` flow.

### Priority 2: High Risk Tests
- **Schema Validation**: Unit test `quiz-api-client.ts` with various payloads to ensure it handles unexpected fields or missing mandatory fields gracefully.
- **Mock Integrity**: Ensure `mock-quiz.json` is bundled and accessible in the test environment.

### Priority 3: Medium/Low Risk Tests
- **Early Trigger Timing**: Verify that if `POST /api/quiz/generate` is called twice (e.g., rapid clicks), the client handles it (debouncing or ignoring second call).

## Risk Acceptance Criteria

### Must Fix Before Production
- All critical risks (TECH-001).
- DATA-001 (Must have Zod validation or equivalent on API responses).

### Can Deploy with Mitigation
- OPS-001 (Acceptable if integration tests verify mock data works).

## Monitoring Requirements
- Track API failure rates for `/api/quiz/generate` vs success of fallback.
- Monitor `QuizEngine` error states via Sentry/Telemetry.
