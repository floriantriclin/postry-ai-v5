# Test Design: Story 1.6 - API de Calcul d'Archétype et d'Affinage

Date: 2026-01-20
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 1 (11%)
- Integration tests: 8 (89%)
- E2E tests: 0 (0%) - *Story is Backend Only*
- Manual/Qualitative: 0 (0%)
- Priority distribution: P0: 3, P1: 5, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: Endpoint de Détermination d'Archétype (`/api/quiz/archetype`)

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 1.6-INT-001 | Integration | P0 | POST /api/quiz/archetype returns 200 + correct archetype | Happy path: validates the core "Phase 1 -> Archetype" workflow |
| 1.6-INT-002 | Integration | P0 | Verify mapping logic from object | Mitigates **DATA-001**: ensures DimensionCode keys are correctly mapped to bits |
| 1.6-INT-003 | Integration | P1 | Returns 400 if answers object missing keys | Mitigates **TECH-001**: ensures all 6 dimensions are present |
| 1.6-INT-004 | Integration | P1 | Returns 400 on invalid answer values (non 'A'/'B') | Mitigates **TECH-001**: ensures input data quality |

### AC2: Endpoint d'Affinage de Vecteur (`/api/quiz/refine`)

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 1.6-INT-005 | Integration | P0 | POST /api/quiz/refine returns 200 + updated vector | Happy path: validates the core "Phase 2 refinement" workflow |
| 1.6-INT-006 | Integration | P1 | Returns 400 on vector length != 9 | Mitigates **BUS-001**: ensures client state isn't corrupted |
| 1.6-INT-007 | Integration | P1 | Returns 400 on invalid DimensionCode | Mitigates **LOGIC-001**: prevents backend crashes from bad codes |
| 1.6-UNIT-008 | Unit | P2 | `updateVector` rounding at boundaries (0, 100) | Mitigates **TECH-002**: ensures mathematical stability |

### AC3: Qualité et Robustesse

| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 1.6-INT-009 | Integration | P1 | Verify `targetDimensions` selection logic | Ensures the 5 dimensions for Phase 2 are correctly selected (3 mandatory + 2 closest to 50) |

## Risk Coverage

| Risk ID | Mitigating Test(s) |
| --- | --- |
| **DATA-001** (Order Desync) | 1.6-INT-002 |
| **TECH-001** (Validation) | 1.6-INT-003, 1.6-INT-004 |
| **BUS-001** (Vector Corruption) | 1.6-INT-006 |
| **LOGIC-001** (Dim Codes) | 1.6-INT-007 |
| **DATA-002** (Ties/Target Dims) | 1.6-INT-009 |
| **TECH-002** (Rounding) | 1.6-UNIT-008 |

## Recommended Execution Order

1. **P0 Integration tests** (1.6-INT-001, 002, 005): Establish functional baseline and data integrity.
2. **P1 Validation tests**: Ensure the API is robust against bad inputs.
3. **P2 Boundary tests**: Fine-tune the logic.

```yaml
test_design:
  scenarios_total: 9
  by_level:
    unit: 1
    integration: 8
    e2e: 0
    manual: 0
  by_priority:
    p0: 3
    p1: 5
    p2: 1
  coverage_gaps: []
```
