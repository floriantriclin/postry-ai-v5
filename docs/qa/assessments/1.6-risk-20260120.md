# Risk Profile: Story 1.6 - API de Calcul d'ArchÃ©type et d'Affinage

Date: 2026-01-20
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 1
- High Risks: 2
- Risk Score: 32/100 (Medium-High Risk)

While these endpoints are purely logic-driven (no LLM), the integrity of the ICE protocol depends on the perfect synchronization between the frontend's question order and the backend's signature calculation.

## Critical Risks Requiring Immediate Attention

### 1. DATA-001: Phase 1 Dimension Order Desynchronization

**Score: 9 (Critical)**
**Probability**: Medium - If the frontend displays questions in an order different from `ICE_PHASE1_DIMENSIONS_ORDER`, the binary signature will be corrupted.
**Impact**: High - The user is assigned a completely wrong archetype, breaking the personalization logic for Phase 2.
**Mitigation**:
- **Adopted**: The API now accepts an object `{ [DimensionCode]: 'A' | 'B' }` instead of a simple array to be order-independent.
- **Testing Focus**: Integration tests verifying that specific answer sequences map to the correct archetypes.

## Risk Distribution

### By Category

- **Technical**: 2 risks (0 critical)
- **Data**: 2 risks (1 critical)
- **Logic**: 1 risk (0 critical)
- **Business**: 1 risk (0 critical)

### By Component

- **Backend (API)**: 4 risks
- **Integration (FE/BE)**: 2 risks

## Detailed Risk Register

| Risk ID  | Description | Probability | Impact | Score | Priority |
| -------- | ----------- | ----------- | ------ | ----- | -------- |
| DATA-001 | Phase 1 Dimension Order Desync | Medium (2) | High (4) | 8 | Critical |
| TECH-001 | Payload Validation Bypass | Low (1) | High (4) | 4 | High |
| BUS-001  | Client-Side Vector Corruption | Medium (2) | Medium (3) | 6 | High |
| LOGIC-001| Refinement Edge Cases | Low (1) | Medium (3) | 3 | Medium |
| DATA-002 | Tie-breaking in Archetype Match | Low (1) | Medium (2) | 2 | Low |
| TECH-002 | Precision Loss in Rounding | Low (1) | Low (1) | 1 | Low |

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests
- **Signature Integrity**: Test all 64 possible Phase 1 combinations (or a representative subset) to ensure the binary -> archetype mapping is exact.
- **Order Robustness**: Verify that sending answers in the wrong order (if known) results in the expected (even if wrong) archetype, confirming the mapping logic.

### Priority 2: High Risk Tests
- **Zod Schema Stress Test**: Send arrays with 5, 7, or 100 elements. Send non-'A'/'B' values. Verify 400 Bad Request.
- **Vector Integrity**: Send vectors with invalid lengths or out-of-bounds numbers to `/api/quiz/refine`.

### Priority 3: Medium/Low Risk Tests
- **Rounding Accuracy**: Verify that `updateVector` behaves correctly at boundaries (0, 100) and with the 0.3 factor.
- **Deterministic Ties**: Verify that when two archetypes are equidistant, the same one is always returned.

## Risk Acceptance Criteria

### Must Fix Before Production
- DATA-001 (Order synchronization) must be guaranteed by code or strict convention.
- TECH-001 (Zod validation for both routes).

### Can Deploy with Mitigation
- BUS-001 (Vector corruption) is a frontend concern; backend should just ensure it doesn't crash.

## Monitoring Requirements
- Track `archetype_distribution` to detect if one archetype is being over-assigned (potential logic bug).
- Monitor `400 Error Rate` on these endpoints to detect frontend/backend schema mismatches.

---
**Risk summary for Gate:**
```yaml
risk_summary:
  totals:
    critical: 1
    high: 2
    medium: 1
    low: 2
  highest:
    id: DATA-001
    score: 8
    title: 'Phase 1 Dimension Order Desynchronization'
  recommendations:
    must_fix:
      - 'Ensure frontend and backend share the exact same dimension order for Phase 1'
      - 'Implement strict Zod validation for answer arrays (length 6, values A/B)'
    monitor:
      - 'Monitor archetype assignment distribution'
```
